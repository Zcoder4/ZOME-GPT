<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZOME - AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-track { background: #1a1a1a; }
        #chat-box::-webkit-scrollbar-thumb { background: #ff0000; border-radius: 10px; }
        .h-screen-safe { height: 100vh; height: calc(var(--vh, 1vh) * 100); }
        .prose pre { background: #000 !important; padding: 12px; border: 1px solid #333; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
        .hidden-chat { display: none !important; }
    </style>
</head>
<body class="bg-[#0a0a0a] text-white">

<div id="menu-overlay" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-[#111] border border-red-900 rounded-2xl p-8 text-center shadow-[0_0_50px_rgba(255,0,0,0.2)]">
        <h1 class="text-3xl font-black text-red-600 mb-2 tracking-tighter uppercase">Zome AI</h1>
        <p class="text-gray-400 text-sm mb-8">Pilih ai mu!</p>
        
        <div class="grid gap-4">
            <button onclick="selectAI('gpt')" class="group relative overflow-hidden bg-red-600 hover:bg-red-700 p-4 rounded-xl font-bold transition-all transform active:scale-95">
                <span class="relative z-10 text-lg">GPT-3 Assistant</span>
                <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform"></div>
            </button>
            
            <button onclick="selectAI('gemini')" class="group relative overflow-hidden bg-transparent border-2 border-red-600 hover:bg-red-600/10 p-4 rounded-xl font-bold transition-all transform active:scale-95 text-red-500 hover:text-red-400">
                <span class="relative z-10 text-lg">Gemini Pro</span>
            </button>
        </div>
        
        <p class="mt-8 text-[10px] text-gray-600 uppercase tracking-widest">made by itszome sipaling</p>
    </div>
</div>

<div id="main-app" class="hidden-chat flex flex-col max-w-5xl mx-auto bg-[#111111] h-screen-safe md:h-[95vh] md:my-[2.5vh] md:border md:border-red-900 md:rounded-xl overflow-hidden shadow-2xl">
    
    <header class="bg-black border-b border-red-600 p-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <button onclick="backToMenu()" class="p-1 hover:text-red-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
            </button>
            <div>
                <h1 id="selected-ai-name" class="font-bold text-red-600 leading-none">AI</h1>
                <span class="text-[10px] text-gray-500 uppercase tracking-widest">System Active</span>
            </div>
        </div>
        <button onclick="clearChat()" class="text-[10px] border border-red-900 px-3 py-1 rounded-full text-red-700 hover:bg-red-600 hover:text-white transition-all">PURGE LOGS</button>
    </header>

    <div id="chat-box" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 bg-black"></div>

    <div class="p-4 bg-black border-t border-red-900">
        <div class="flex items-end gap-3 max-w-4xl mx-auto">
            <textarea id="user-input" rows="1" placeholder="Masukkan perintah..." class="flex-1 bg-[#1a1a1a] text-white border border-red-900 focus:border-red-600 rounded-xl py-3 px-4 outline-none resize-none transition-colors"></textarea>
            <button id="send-btn" class="bg-red-600 hover:bg-red-700 text-white p-3.5 rounded-xl shadow-[0_0_20px_rgba(255,0,0,0.2)] active:scale-90">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" /></svg>
            </button>
        </div>
    </div>
</div>

<script>
    let currentAI = 'gpt';
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const menuOverlay = document.getElementById('menu-overlay');
    const mainApp = document.getElementById('main-app');

    // Model URLs
    const apis = {
        gpt: (text) => `https://api.siputzx.my.id/api/ai/gpt3?prompt=You%20are%20a%20helpful%20assistant.&content=${encodeURIComponent(text)}`,
        gemini: (text) => `https://api-faa.my.id/faa/bard-google?query=${encodeURIComponent(text)}`
    };

    function selectAI(type) {
        currentAI = type;
        document.getElementById('selected-ai-name').innerText = type === 'gpt' ? 'GPT-3 ASSISTANT' : 'GEMINI PRO';
        menuOverlay.style.display = 'none';
        mainApp.classList.remove('hidden-chat');
        loadLocalHistory();
    }

    function backToMenu() {
        menuOverlay.style.display = 'flex';
        mainApp.classList.add('hidden-chat');
    }

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        appendToUI(text, 'user');
        userInput.value = '';
        userInput.style.height = 'auto';
        sendBtn.disabled = true;

        const loadingId = 'ai-' + Date.now();
        appendToUI('Sedang memproses...', 'ai', loadingId);

        try {
            const response = await fetch(apis[currentAI](text));
            const res = await response.json();
            
            // Handle different API response structures
            let content = "";
            if (currentAI === 'gpt') {
                content = res.data || res.result || "No response from GPT.";
            } else {
                content = res.result || res.data || res.response || "No response from Gemini.";
            }
            
            const target = document.getElementById(loadingId);
            target.innerHTML = marked.parse(content);
            target.querySelectorAll('pre code').forEach((el) => hljs.highlightElement(el));
            
            saveToHistory(text, 'user');
            saveToHistory(content, 'ai');
        } catch (e) {
            document.getElementById(loadingId).innerText = "EROR: Koneksi API Gagal.";
        } finally {
            sendBtn.disabled = false;
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }
    }

    // --- Core Functions ---
    function appendToUI(content, role, id = null) {
        const wrapper = document.createElement('div');
        wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
        const bubble = document.createElement('div');
        if(id) bubble.id = id;
        
        bubble.className = role === 'user' 
            ? "bg-red-600 text-white p-4 rounded-xl rounded-tr-none max-w-[85%] font-medium"
            : "bg-[#1a1a1a] border-l-4 border-red-600 text-white p-4 rounded-r-xl max-w-[85%] prose prose-invert";
        
        bubble.innerHTML = role === 'user' ? content : marked.parse(content);
        wrapper.appendChild(bubble);
        chatBox.appendChild(wrapper);
        chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
    }

    function saveToHistory(content, role) {
        let history = JSON.parse(localStorage.getItem(`history_${currentAI}`)) || [];
        history.push({ content, role });
        localStorage.setItem(`history_${currentAI}`, JSON.stringify(history));
    }

    function loadLocalHistory() {
        chatBox.innerHTML = '';
        let history = JSON.parse(localStorage.getItem(`history_${currentAI}`)) || [];
        history.forEach(msg => appendToUI(msg.content, msg.role));
    }

    function clearChat() {
        localStorage.removeItem(`history_${currentAI}`);
        chatBox.innerHTML = '';
    }

    function setVh() { document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`); }
    window.addEventListener('resize', setVh);
    setVh();

    userInput.addEventListener('input', function() { this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px'; });
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });
</script>

</body>
</html>
